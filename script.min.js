const notes=["E","B","G","D","A","E"],noteMap=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],stringOffsets=[4,11,7,2,9,4],fretboard=document.getElementById("fretboard"),taskDisplay=document.getElementById("task-text"),feedback=document.getElementById("feedback"),stringSelect=document.getElementById("string-select"),noteTypeSelect=document.getElementById("note-type-select");let target={};const modeSelect=document.getElementById("mode-select"),showNotesToggle=document.getElementById("show-notes-toggle"),intervalCheatsheet=document.getElementById("interval-cheatsheet"),chords={major:[0,4,7],minor:[0,3,7],diminished:[0,3,6],augmented:[0,4,8],major7:[0,4,7,11],minor7:[0,3,7,10],dominant7:[0,4,7,10],diminished7:[0,3,6,9]};function getChordNotes(e,t){const n=noteMap.indexOf(e);return chords[t].map(e=>noteMap[(n+e)%12])}function noteAt(e,t){return noteMap[(stringOffsets[e]+t)%12]}function isNoteValid(e){const t=noteTypeSelect.value,n=!e.includes("#");return"all"===t||("natural"===t?n:"accidental"!==t||!n)}let clickedPositions=[],incorrectPositions=[];function renderFretboard(){fretboard.innerHTML="",feedback.textContent="",feedback.classList.remove("feedback-correct","feedback-incorrect");const e=fretboard.clientWidth,t=fretboard.clientHeight,n=13,o=stringSelect.value,r=modeSelect.value,d=showNotesToggle.checked;for(let e=0;e<6;e++){const n=.05,r=n*t+e/5*(t*(1-2*n)),d=document.createElement("div");d.classList.add("string-hitbox"),d.style.top=`${r}px`,d.dataset.string=e,"all"!==o&&e===parseInt(o)-1&&"interval"!==modeSelect.value&&d.classList.add("glow"),d.addEventListener("click",handleClick);const a=document.createElement("div");a.classList.add("string-line"),d.appendChild(a),fretboard.appendChild(d)}const a=[3,5,7,9,12];for(let o=0;o<n;o++){const n=o/12*e,r=document.createElement("div");if(r.classList.add("fret-line"),r.style.left=`${n}px`,fretboard.appendChild(r),o>0){const t=document.createElement("div");t.classList.add("fret-label");const n=(o-.5)/12*e;t.style.left=`${n}px`,t.textContent=o,fretboard.appendChild(t)}if(a.includes(o)){const r=document.createElement("div");if(r.classList.add("dot-marker"),r.style.left=n-e/12/2+"px",r.style.top=(12===o?t/2-30:t/2)+"px",fretboard.appendChild(r),12===o){const e=r.cloneNode();e.style.top=t/2+30+"px",fretboard.appendChild(e)}}}if("chord"===r&&clickedPositions.length>0&&clickedPositions.forEach(n=>{const o=(n.fret-1+.5)*(e/12),r=.05*t+n.string/5*(.9*t),d=document.createElement("div");d.classList.add("marker","correct"),d.style.left=`${o}px`,d.style.top=`${r}px`,fretboard.appendChild(d)}),"chord"===r&&incorrectPositions.length>0&&incorrectPositions.forEach(n=>{const o=(n.fret-1+.5)*(e/12),r=.05*t+n.string/5*(.9*t),d=document.createElement("div");d.classList.add("marker","incorrect"),d.style.left=`${o}px`,d.style.top=`${r}px`,fretboard.appendChild(d)}),d)for(let n=0;n<6;n++)for(let o=0;o<=12;o++){const r=noteAt(n,o),d=o/12*e,a=.05,i=a*t+n/5*(t*(1-2*a)),s=document.createElement("div");s.classList.add("note-label"),s.classList.add(r.includes("#")?"accidental":"natural"),s.style.left=d-e/12/2+"px",s.style.top=`${i}px`,s.textContent=r,fretboard.appendChild(s)}}function updateNoteControlsVisibility(){const e=modeSelect.value,t=document.getElementById("string-select").parentElement.parentElement,n=document.getElementById("note-type-select").parentElement.parentElement;"interval"===e||"chord"===e?(t.style.display="none",n.style.display="none"):(t.style.display="flex",n.style.display="flex")}function ordinal(e){return 1===e?"1st":2===e?"2nd":3===e?"3rd":`${e}th`}function newTask(){const e=modeSelect.value;if("interval"===e){const e=[{name:"minor 2nd",semitones:1},{name:"major 2nd",semitones:2},{name:"minor 3rd",semitones:3},{name:"major 3rd",semitones:4},{name:"perfect 4th",semitones:5},{name:"tritone",semitones:6},{name:"perfect 5th",semitones:7},{name:"minor 6th",semitones:8},{name:"major 6th",semitones:9},{name:"minor 7th",semitones:10},{name:"major 7th",semitones:11},{name:"octave",semitones:12}],t=noteMap[Math.floor(12*Math.random())],n=e[Math.floor(Math.random()*e.length)];return target={mode:"interval",root:t,semitones:n.semitones,intervalName:n.name},void(taskDisplay.textContent=`Find the ${n.name} from ${t}`)}if("chord"===e){const e=Object.keys(chords),t=e[Math.floor(Math.random()*e.length)],n=noteMap[Math.floor(12*Math.random())],o=getChordNotes(n,t);clickedPositions=[],incorrectPositions=[],target={mode:"chord",root:n,chordType:t,chordNotes:o,selectedNotes:[],completed:!1};const r={major:"major",minor:"minor",diminished:"diminished",augmented:"augmented",major7:"major 7th",minor7:"minor 7th",dominant7:"dominant 7th",diminished7:"diminished 7th"}[t];return void(taskDisplay.textContent=`Find all the notes in ${n} ${r} chord`)}let t;const n=stringSelect.value;let o,r;t="all"===n?Math.floor(6*Math.random()):parseInt(n)-1;do{r=Math.floor(12*Math.random())+1,o=noteAt(t,r)}while(!isNoteValid(o));target={string:t,fret:r,note:o};const d=ordinal(t+1);taskDisplay.textContent=`Click on the ${o} note on the ${d} string.`}function handleClick(e){const t=modeSelect.value,n=parseInt(e.currentTarget.dataset.string),o=e.offsetX,r=fretboard.clientWidth,d=Math.floor(o/(r/12))+1,a=noteAt(n,d),i=.05*fretboard.clientHeight+n/5*(.9*fretboard.clientHeight),s=document.createElement("div");if(s.classList.add("marker"),s.style.left=`${o}px`,s.style.top=`${i}px`,"interval"===t){const t=noteMap[(noteMap.indexOf(target.root)+target.semitones)%12];return void(a===t?(s.classList.add("correct"),showFeedback(`<div>✅ Good!</div><div style="font-size: 14px; color: #aaa;">You found ${a} correctly!</div>`,"feedback-correct"),createParticles(e.clientX,e.clientY,!0),fretboard.appendChild(s),setTimeout(()=>{renderFretboard(),newTask()},2e3)):(s.classList.add("incorrect"),showFeedback(`<div>❌ OOPS</div><div style="font-size: 14px; color: #aaa;">You clicked ${a}. Expected ${t}.</div>`,"feedback-incorrect"),createParticles(e.clientX,e.clientY,!1),fretboard.appendChild(s)))}if("chord"===t)return target.chordNotes.includes(a)?target.selectedNotes.includes(a)?(s.classList.add("incorrect"),showFeedback(`<div>❌ Already found!</div><div style="font-size: 14px; color: #aaa;">You already found ${a}. Find the remaining notes: ${target.chordNotes.filter(e=>!target.selectedNotes.includes(e)).join(", ")}</div>`,"feedback-incorrect"),createParticles(e.clientX,e.clientY,!1)):(target.selectedNotes.push(a),clickedPositions.push({string:n,fret:d}),s.classList.add("correct"),target.selectedNotes.length===target.chordNotes.length?(showFeedback(`<div>✅ Chord Complete!</div><div style="font-size: 14px; color: #aaa;">You found all notes in ${target.root} ${target.chordType} chord!</div>`,"feedback-correct"),createParticles(e.clientX,e.clientY,!0),target.completed=!0,setTimeout(()=>{target.selectedNotes=[],clickedPositions=[],incorrectPositions=[],renderFretboard(),newTask()},2e3)):(showFeedback(`<div>✅ Good!</div><div style="font-size: 14px; color: #aaa;">Found ${a}.</div>`,"feedback-correct"),createParticles(e.clientX,e.clientY,!0))):(s.classList.add("incorrect"),showFeedback(`<div>❌ Not in chord!</div><div style="font-size: 14px; color: #aaa;">${a} is not in ${target.root} ${target.chordType} chord. Need: ${target.chordNotes.filter(e=>!target.selectedNotes.includes(e)).join(", ")}</div>`,"feedback-incorrect"),createParticles(e.clientX,e.clientY,!1),incorrectPositions.push({string:n,fret:d})),void fretboard.appendChild(s);if(s.classList.add("marker"),s.style.left=`${o}px`,s.style.top=`${i}px`,a===target.note&&n===target.string)s.classList.add("correct"),showFeedback(`<div>✅ Good!</div><div style="font-size: 14px; color: #aaa;">You found ${a} on the ${ordinal(n+1)} string!</div>`,"feedback-correct"),createParticles(e.clientX,e.clientY,!0),fretboard.appendChild(s),setTimeout(()=>{renderFretboard(),newTask()},2e3);else{const t=target.string,o=target.note,r=ordinal(t+1),d=ordinal(n+1);s.classList.add("incorrect"),showFeedback(`<div>❌ OOPS</div><div style="font-size: 14px; color: #aaa;">You clicked ${a} on the ${d} string. Expected ${o} on the ${r} string.</div>`,"feedback-incorrect"),createParticles(e.clientX,e.clientY,!1),fretboard.appendChild(s)}}function createParticles(e,t,n){const o=n?["#4CAF50"]:["#f44336"],r=e,d=t;for(let e=0;e<1;e++){const e=document.createElement("div");e.className="particle";const t=18;e.style.width=t+"px",e.style.height=t+"px",e.style.left=r-t/2+"px",e.style.top=d-t/2+"px",e.style.backgroundColor=o[Math.floor(Math.random()*o.length)];const n=60*Math.random()-30,a=60*Math.random()-30;e.style.transform=`translate(${n}px, ${a}px)`,document.body.appendChild(e),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},1e3)}}function updateInstructions(){const e=modeSelect.value,t=document.getElementById("instructions-title"),n=document.getElementById("instructions-text");"interval"===e?(t.textContent="Interval Training",n.textContent="In guitar theory (and music theory in general), intervals are the building blocks of melody and harmony. An interval is the distance between two notes, measured in steps or semitones."):"chord"===e?(t.textContent="Chord Training",n.textContent="Learn to identify the notes that make up different chord types. Click on all the notes that belong to the given chord. You can select notes in any order, and the exercise is complete when you've found all the required notes."):(t.textContent="Note Training",n.textContent="Knowing the notes of the guitar neck from memory is one of the most powerful things you can do as a guitarist. It unlocks fluency, creativity, and precision in virtually every area of your playing. Test your knowledge by  guessing the note on the fretboard.")}function showModal(e){const t=document.getElementById("modal-overlay"),n=document.getElementById("modal-content-inner"),o=document.getElementById(e).innerHTML;n.innerHTML=o,t.style.display="flex"}function hideModal(){document.getElementById("modal-overlay").style.display="none"}function handleScroll(){const e=document.querySelector(".main-header");window.innerWidth<=600||window.scrollY>50?e.classList.add("scrolled"):e.classList.remove("scrolled")}function showFeedback(e,t){feedback.textContent="",feedback.classList.remove("feedback-correct","feedback-incorrect"),requestAnimationFrame(()=>{feedback.innerHTML=e,feedback.classList.add(t)})}document.getElementById("new-task").addEventListener("click",()=>{"chord"===modeSelect.value&&(clickedPositions=[],incorrectPositions=[],target&&target.selectedNotes&&(target.selectedNotes=[])),feedback.textContent="",feedback.classList.remove("feedback-correct","feedback-incorrect"),renderFretboard(),newTask()}),modeSelect.addEventListener("change",()=>{"interval"===modeSelect.value&&(stringSelect.value="all"),renderFretboard(),newTask(),updateInstructions(),updateNoteControlsVisibility()}),stringSelect.addEventListener("change",()=>{renderFretboard(),newTask()}),noteTypeSelect.addEventListener("change",()=>{renderFretboard(),newTask()}),showNotesToggle.addEventListener("change",()=>{renderFretboard()}),document.getElementById("info-icon").addEventListener("click",()=>{const e=modeSelect.value;let t;t="interval"===e?"interval-modal-content":"chord"===e?"chord-modal-content":"note-modal-content",showModal(t)}),document.getElementById("modal-close").addEventListener("click",hideModal),document.getElementById("modal-overlay").addEventListener("click",e=>{"modal-overlay"===e.target.id&&hideModal()}),renderFretboard(),newTask(),updateInstructions(),updateNoteControlsVisibility(),window.addEventListener("scroll",handleScroll),handleScroll();