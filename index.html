<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Don't Fret it</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #121212;
      color: #e0e0e0;
      text-align: center;
      padding: 40px 20px;
      margin: 0;
      box-sizing: border-box;
    }
    h1 {
      font-size: 2em;
      margin-bottom: 30px;
      color: #f1f1f1;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    #controls {
      background-color: #1a1a1a;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 40px;
      max-width: 650px;
      margin-left: auto;
      margin-right: auto;
      border: 1px solid #333;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    .control-section {
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 1px solid #333;
    }
    .control-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .control-section h3 {
      margin: 0 0 15px 0;
      color: #f1f1f1;
      font-size: 1.1em;
      text-align: left;
    }
    .control-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
      margin-bottom: 15px;
    }
    .control-row:last-child {
      margin-bottom: 0;
    }
    .control-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .control-group label {
      font-weight: 500;
      color: #ccc;
      white-space: nowrap;
    }
    select {
      padding: 8px 12px;
      font-size: 14px;
      border: 1px solid #444;
      border-radius: 6px;
      background-color: #2a2a2a;
      color: #e0e0e0;
      cursor: pointer;
      min-width: 120px;
    }
    select:focus {
      outline: none;
      border-color: #666;
      box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
    }
    input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: #666;
    }
    #fretboard {
      position: relative;
      width: 100%;
      max-width: 650px;
      height: auto;
      aspect-ratio: 13 / 6;
      margin: 0 auto 30px auto;
      border: 1px solid #444;
      background: #2b1a10;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    .string-hitbox {
      position: absolute;
      left: 0;
      right: 0;
      height: 12px;
      transform: translateY(-50%);
      cursor: pointer;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    .string-line {
      position: absolute;
      left: 0;
      right: 0;
      top: 50%;
      height: 2px;
      z-index: 2;
      -webkit-tap-highlight-color: transparent;
    }
    .string-hitbox:nth-child(1) .string-line { background-color: #666; }
    .string-hitbox:nth-child(2) .string-line { background-color: #777; }
    .string-hitbox:nth-child(3) .string-line { background-color: #888; }
    .string-hitbox:nth-child(4) .string-line { background-color: #999; }
    .string-hitbox:nth-child(5) .string-line { background-color: #aaa; }
    .string-hitbox:nth-child(6) .string-line { background-color: #bbb; }
    .glow .string-line {
      box-shadow: 0 0 10px 2px rgba(255, 255, 100, 0.8);
    }
    .fret-line {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 2px;
      background-color: silver;
    }
    .fret-label {
      position: absolute;
      top: -25px;
      font-size: 12px;
      font-weight: bold;
      color: #ccc;
      transform: translateX(-50%);
    }
    .marker {
      position: absolute;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      transform: translate(-50%, -50%);
    }
    .marker.correct {
      box-shadow: 0 0 20px 5px rgba(76, 175, 80, 0.8);
      animation: markerPop 0.4s ease-out;
    }
    .marker.incorrect {
      box-shadow: 0 0 20px 5px rgba(244, 67, 54, 0.8);
      animation: markerPop 0.4s ease-out;
    }
    .marker.hint {
      box-shadow: 0 0 10px 2px lightgreen;
    }
    .dot-marker {
      position: absolute;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
    }
    .note-label {
      position: absolute;
      font-size: 10px;
      font-weight: bold;
      color: #fff;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 2px 4px;
      border-radius: 3px;
      transform: translate(-50%, -50%);
      pointer-events: none;
      z-index: 3;
    }
    .note-label.natural {
      color: #fff;
    }
    .note-label.accidental {
      color: #ffcc00;
    }
    button {
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      background-color: #333;
      color: #fff;
      cursor: pointer;
      margin-top: 10px;
      transition: background-color 0.2s ease;
    }
    button:hover {
      background-color: #555;
    }
    #new-task {
      width: 45px;
      height: 45px;
      padding: 0;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      background: linear-gradient(135deg, #444 0%, #333 100%);
      border: 2px solid #555;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      transition: all 0.2s ease;
      flex-shrink: 0;
    }
    #new-task:hover {
      background: linear-gradient(135deg, #555 0%, #444 100%);
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    }
    #new-task::before {
      content: '↻';
      font-size: 20px;
      font-weight: bold;
    }
    #feedback {
      margin: 20px auto 40px auto;
      font-size: 16px;
      font-weight: 600;
      padding: 12px 20px;
      border-radius: 6px;
      max-width: 500px;
      text-align: center;
      min-height: 50px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
      border: 1px solid #444;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      opacity: 1;
      transition: opacity 0.3s ease;
    }
    #feedback:empty {
      opacity: 0;
    }
    #task {
      background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
      border: 2px solid #444;
      border-radius: 12px;
      padding: 20px 25px;
      margin: 30px auto 50px auto;
      max-width: 650px;
      font-size: 1.3em;
      font-weight: 600;
      color: #f1f1f1;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 15px;
      min-height: 80px;
    }
    #task-text {
      flex: 1;
    }
    #task::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #ffcc00, #ff6b6b, #4ecdc4, #45b7d1);
    }
    #task-container {
      margin: 30px 0;
    }
    .task-label {
      display: block;
      font-size: 0.8em;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
      font-weight: 400;
    }
    #helpful-resources {
      display: none;
    }
    #interval-cheatsheet {
      margin-top: 30px;
      padding: 20px;
      background-color: #1a1a1a;
      border-radius: 8px;
      border: 1px solid #444;
      text-align: left;
      max-width: 650px;
      margin-left: 0;
    }
    #interval-cheatsheet h3 {
      margin-top: 0;
      color: #f1f1f1;
      margin-bottom: 15px;
    }
    .interval-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #333;
    }
    .interval-row:last-child {
      border-bottom: none;
    }
    .interval-name {
      font-weight: bold;
      color: #ffcc00;
      min-width: 120px;
    }
    .interval-semitone {
      color: #ccc;
      min-width: 80px;
    }
    .interval-description {
      color: #aaa;
      flex: 1;
      margin-left: 20px;
    }
    @media (max-width: 600px) {
      #controls {
        padding: 20px;
        margin: 0 10px 30px 10px;
      }
      .control-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      .control-group {
        width: 100%;
        justify-content: space-between;
      }
      select {
        min-width: 100px;
        flex: 1;
        max-width: 150px;
      }
      h1 {
        font-size: 1.5em;
      }
      .fret-label {
        font-size: 10px;
        top: -20px;
      }
      button {
        font-size: 14px;
        padding: 10px 20px;
      }
      #new-task {
        width: 45px;
        height: 45px;
      }
      #new-task::before {
        font-size: 20px;
      }
      .string-hitbox {
        height: 8px;
      }
      #task {
        font-size: 1.1em;
        padding: 15px 20px;
        margin: 20px 10px;
      }
    }
    @media (max-width: 400px) {
      .control-group {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      select {
        max-width: none;
        width: 100%;
      }
    }
    /* Animation keyframes */
    @keyframes correctPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    @keyframes incorrectShake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }

    @keyframes particleFloat {
      0% {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
      100% {
        transform: translateY(-100px) scale(0);
        opacity: 0;
      }
    }

    @keyframes markerPop {
      0% { transform: translate(-50%, -50%) scale(0); }
      50% { transform: translate(-50%, -50%) scale(1.2); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }

    /* Animation classes */
    .feedback-correct {
      animation: correctPulse 0.6s ease-in-out;
      background: linear-gradient(135deg, #2d5a2d 0%, #1a3a1a 100%) !important;
      border-color: #4CAF50 !important;
    }

    .feedback-incorrect {
      animation: incorrectShake 0.5s ease-in-out;
      background: linear-gradient(135deg, #5a2d2d 0%, #3a1a1a 100%) !important;
      border-color: #f44336 !important;
    }

    .screen-flash {
      animation: screenFlash 0.3s ease-in-out;
    }

    .marker.correct {
      box-shadow: 0 0 20px 5px rgba(76, 175, 80, 0.8);
      animation: markerPop 0.4s ease-out;
    }

    .marker.incorrect {
      box-shadow: 0 0 20px 5px rgba(244, 67, 54, 0.8);
      animation: markerPop 0.4s ease-out;
    }

    .particle {
      position: fixed;
      pointer-events: none;
      z-index: 1000;
      border-radius: 50%;
      animation: particleFloat 1s ease-out forwards;
      box-shadow: 0 0 8px 2px rgba(255, 255, 255, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.8);
    }

    /* Instructions and Modal Styles */
    .instructions {
      background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
      border: 2px solid #444;
      border-radius: 12px;
      padding: 20px 25px;
      margin: 20px auto 30px auto;
      max-width: 650px;
      color: #e0e0e0;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    .instructions h3 {
      margin: 0 0 15px 0;
      color: #f1f1f1;
      font-size: 1.2em;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .instructions p {
      margin: 0 0 15px 0;
      line-height: 1.6;
      color: #ccc;
    }

    .info-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      background: #666;
      border-radius: 50%;
      color: #fff;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-left: 10px;
    }

    .info-icon:hover {
      background: #888;
      transform: scale(1.1);
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .modal-content {
      background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
      border: 2px solid #444;
      border-radius: 12px;
      padding: 30px;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      color: #e0e0e0;
      box-shadow: 0 8px 40px rgba(0,0,0,0.5);
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 15px;
      right: 20px;
      background: none;
      border: none;
      color: #888;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s ease;
    }

    .modal-close:hover {
      color: #fff;
    }

    .modal-content h3 {
      margin: 0 0 20px 0;
      color: #f1f1f1;
      font-size: 1.3em;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .modal-content .interval-row {
      display: flex;
      justify-content: flex-start;
      align-items: flex-start;
      padding: 8px 0;
      border-bottom: 1px solid #333;
      text-align: left;
    }

    .modal-content .interval-name {
      font-weight: bold;
      color: #ffcc00;
      min-width: 120px;
      margin-right: 20px;
    }

    .modal-content .interval-semitone {
      color: #ccc;
      min-width: 80px;
      margin-right: 20px;
    }

    .modal-content .interval-description {
      color: #aaa;
      flex: 1;
    }

    #fretboard-controls {
      background-color: #1a1a1a;
      border-radius: 12px;
      padding: 20px 25px;
      margin: 0 auto 20px auto;
      max-width: 650px;
      border: 1px solid #333;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
  <h1>Don't Fret it, learn it</h1>
  <div id="controls">
    <div class="control-section">
      <h3>Training Mode</h3>
      <div class="control-row">
        <div class="control-group">
          <label for="mode-select">Training mode:</label>
          <select id="mode-select">
            <option value="note">Note Training</option>
            <option value="interval">Interval Training</option>
          </select>
        </div>
      </div>
    </div>
  </div>
  <div id="instructions" class="instructions">
    <h3 id="instructions-title">Note Training</h3>
    <p id="instructions-text">Knowing the notes of the guitar neck from memory is one of the most powerful things you can do as a guitarist. It unlocks fluency, creativity, and precision in virtually every area of your playing.</p>
    <span class="info-icon" id="info-icon">i</span>
  </div>
  <div id="fretboard-controls" class="control-section">
    <h3>Fretboard Controls</h3>
    <div class="control-row">
      <div class="control-group">
        <label for="string-select">Choose string:</label>
        <select id="string-select">
          <option value="all">All</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
        </select>
      </div>
      <div class="control-group">
        <label for="note-type-select">Note type:</label>
        <select id="note-type-select">
          <option value="all">All</option>
          <option value="natural">Naturals only</option>
          <option value="accidental">Sharps & Flats</option>
        </select>
      </div>
    </div>
    <div class="control-row">
      <div class="control-group">
        <label for="show-notes-toggle">Show Notes:</label>
        <input type="checkbox" id="show-notes-toggle">
      </div>
    </div>
  </div>
  <div id="task-container">
    <span class="task-label">Current Task</span>
    <div id="task">
      <span id="task-text"></span>
      <button id="new-task"></button>
    </div>
  </div>
  <div id="fretboard"></div>
  <div id="feedback"></div>

  <!-- Modal Overlay -->
  <div id="modal-overlay" class="modal-overlay">
    <div class="modal-content">
      <button class="modal-close" id="modal-close">&times;</button>
      <div id="modal-content-inner"></div>
    </div>
  </div>

  <script>
    const notes = ['E', 'A', 'D', 'G', 'B', 'E'];
    const noteMap = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
    const stringOffsets = [4, 9, 2, 7, 11, 4]; // 1=E, 2=A, 3=D, 4=G, 5=B, 6=E
    const fretboard = document.getElementById('fretboard');
    const taskDisplay = document.getElementById('task-text');
    const feedback = document.getElementById('feedback');
    const stringSelect = document.getElementById('string-select');
    const noteTypeSelect = document.getElementById('note-type-select');
    let target = {};
    const modeSelect = document.getElementById('mode-select');
    const showNotesToggle = document.getElementById('show-notes-toggle');
    const intervalCheatsheet = document.getElementById('interval-cheatsheet');

    function noteAt(stringIndex, fret) {
      const base = stringOffsets[stringIndex];
      return noteMap[(base + fret) % 12];
    }

    function isNoteValid(note) {
      const type = noteTypeSelect.value;
      const isNatural = !note.includes('#');
      if (type === 'all') return true;
      if (type === 'natural') return isNatural;
      if (type === 'accidental') return !isNatural;
      return true;
    }

    function renderFretboard() {
      fretboard.innerHTML = '';
      feedback.textContent = '';
      feedback.classList.remove('feedback-correct', 'feedback-incorrect');
      const width = fretboard.clientWidth;
      const height = fretboard.clientHeight;
      const fretCount = 13;
      const selectedString = stringSelect.value;
      const mode = modeSelect.value;
      const showNotes = showNotesToggle.checked;

      for (let string = 0; string < 6; string++) {
        const y = ((string + 1) / 7) * height;
        const div = document.createElement('div');
        div.classList.add('string-hitbox');
        div.style.top = `${y}px`;
        div.dataset.string = string;
        if (selectedString !== 'all' && string === parseInt(selectedString) - 1 && modeSelect.value !== 'interval') {
          div.classList.add('glow');
        }
        div.addEventListener('click', handleClick);

        const line = document.createElement('div');
        line.classList.add('string-line');
        div.appendChild(line);

        fretboard.appendChild(div);
      }

      const dotFrets = [3, 5, 7, 9, 12];
      for (let fret = 0; fret < fretCount; fret++) {
        const x = (fret / (fretCount - 1)) * width;

        const line = document.createElement('div');
        line.classList.add('fret-line');
        line.style.left = `${x}px`;
        fretboard.appendChild(line);

        const label = document.createElement('div');
        label.classList.add('fret-label');
        label.style.left = `${x}px`;
        label.textContent = fret;
        fretboard.appendChild(label);

        if (dotFrets.includes(fret)) {
          const dot = document.createElement('div');
          dot.classList.add('dot-marker');
          dot.style.left = `${x - (width / (fretCount - 1)) / 2}px`;
          dot.style.top = `${fret === 12 ? height / 2 - 30 : height / 2}px`;
          fretboard.appendChild(dot);

          if (fret === 12) {
            const dot2 = dot.cloneNode();
            dot2.style.top = `${height / 2 + 30}px`;
            fretboard.appendChild(dot2);
          }
        }
      }

      // Add note labels if toggle is enabled
      if (showNotes) {
        for (let string = 0; string < 6; string++) {
          for (let fret = 0; fret <= 12; fret++) {
            const note = noteAt(string, fret);
            const x = (fret / (fretCount - 1)) * width;
            const y = ((string + 1) / 7) * height;

            const noteLabel = document.createElement('div');
            noteLabel.classList.add('note-label');
            noteLabel.classList.add(note.includes('#') ? 'accidental' : 'natural');
            // Position notes in the gap before the fret (between previous fret and current fret)
            noteLabel.style.left = `${x - (width / (fretCount - 1)) / 2}px`;
            noteLabel.style.top = `${y}px`;
            noteLabel.textContent = note;
            fretboard.appendChild(noteLabel);
          }
        }
      }
    }

    function updateNoteControlsVisibility() {
      const mode = modeSelect.value;
      const stringSelect = document.getElementById('string-select').parentElement.parentElement;
      const noteTypeSelect = document.getElementById('note-type-select').parentElement.parentElement;

      if (mode === 'interval') {
        stringSelect.style.display = 'none';
        noteTypeSelect.style.display = 'none';
      } else {
        stringSelect.style.display = 'flex';
        noteTypeSelect.style.display = 'flex';
      }
    }

    function ordinal(n) {
      if (n === 1) return "1st";
      if (n === 2) return "2nd";
      if (n === 3) return "3rd";
      return `${n}th`;
    }

    function newTask() {
      const mode = modeSelect.value;
      if (mode === 'interval') {
        const intervals = [
          { name: 'minor 2nd', semitones: 1 },
          { name: 'major 2nd', semitones: 2 },
          { name: 'minor 3rd', semitones: 3 },
          { name: 'major 3rd', semitones: 4 },
          { name: 'perfect 4th', semitones: 5 },
          { name: 'tritone', semitones: 6 },
          { name: 'perfect 5th', semitones: 7 },
          { name: 'minor 6th', semitones: 8 },
          { name: 'major 6th', semitones: 9 },
          { name: 'minor 7th', semitones: 10 },
          { name: 'major 7th', semitones: 11 },
          { name: 'octave', semitones: 12 }
        ];
        const rootNote = noteMap[Math.floor(Math.random() * 12)];
        const interval = intervals[Math.floor(Math.random() * intervals.length)];
        target = {
          mode: 'interval',
          root: rootNote,
          semitones: interval.semitones,
          intervalName: interval.name
        };
        taskDisplay.textContent = `Find the ${interval.name} from ${rootNote}`;
        return;
      }

      let string;
      const selected = stringSelect.value;
      if (selected === 'all') {
        string = Math.floor(Math.random() * 6);
      } else {
        string = parseInt(selected) - 1;
      }

      let note, fret;
      do {
        fret = Math.floor(Math.random() * 12) + 1;
        note = noteAt(string, fret);
      } while (!isNoteValid(note));

      target = { string, fret, note };
      const displayString = ordinal(string + 1);
      taskDisplay.textContent = `Click on the ${note} note on the ${displayString} string.`;
    }

    function handleClick(e) {
      const mode = modeSelect.value;
      const visualIndex = parseInt(e.currentTarget.dataset.string);
      const clickedString = visualIndex;
      const selected = stringSelect.value;

      const x = event.offsetX;
      const width = fretboard.clientWidth;
      const fret = Math.floor((x / (width / 12))) + 1;
      const note = noteAt(clickedString, fret);

      const y = ((clickedString + 1) / 7) * fretboard.clientHeight;
      const marker = document.createElement('div');
      marker.classList.add('marker');
      marker.style.left = `${x}px`;
      marker.style.top = `${y}px`;

      if (mode === 'interval') {
        const expectedNote = noteMap[(noteMap.indexOf(target.root) + target.semitones) % 12];
        if (note === expectedNote) {
          marker.classList.add('correct');
          feedback.innerHTML = `<div>✅ Yeh boy!</div><div style="font-size: 14px; color: #aaa;">You found ${note} correctly!</div>`;
          feedback.classList.add('feedback-correct');
          createParticles(e.clientX, e.clientY, true);
        } else {
          marker.classList.add('incorrect');
          feedback.innerHTML = `<div>❌ OOPS</div><div style="font-size: 14px; color: #aaa;">You clicked ${note}. Expected ${expectedNote}.</div>`;
          feedback.classList.add('feedback-incorrect');
          createParticles(e.clientX, e.clientY, false);

          for (let s = 0; s < 6; s++) {
            for (let f = 0; f <= 12; f++) {
              if (noteAt(s, f) === expectedNote && f > 0) {
                const hintX = (f - 1 + 0.5) * (width / 12);
                const hintY = ((s + 1) / 7) * fretboard.clientHeight;
                const hint = document.createElement('div');
                hint.classList.add('marker', 'hint');
                hint.style.left = `${hintX}px`;
                hint.style.top = `${hintY}px`;
                fretboard.appendChild(hint);
              }
            }
          }
        }
        fretboard.appendChild(marker);
        setTimeout(() => {
          renderFretboard();
          newTask();
        }, 3000);
        return;
      }
      marker.classList.add('marker');
      marker.style.left = `${x}px`;
      marker.style.top = `${y}px`;

      if (note === target.note && clickedString === target.string) {
        marker.classList.add('correct');
        feedback.innerHTML = `<div>✅ Yeh boy!</div><div style="font-size: 14px; color: #aaa;">You found ${note} on the ${ordinal(clickedString + 1)} string!</div>`;
        feedback.classList.add('feedback-correct');
        createParticles(e.clientX, e.clientY, true);
      } else {
        const expectedString = target.string;
        const expectedFret = target.fret;
        const expectedNote = target.note;
        const expectedStringLabel = ordinal(expectedString + 1);
        const actualStringLabel = ordinal(clickedString + 1);
        marker.classList.add('incorrect');
        feedback.innerHTML = `<div>❌ OOPS</div><div style="font-size: 14px; color: #aaa;">You clicked ${note} on the ${actualStringLabel} string. Expected ${expectedNote} on the ${expectedStringLabel} string.</div>`;
        feedback.classList.add('feedback-incorrect');
        createParticles(e.clientX, e.clientY, false);

        const expectedX = (expectedFret - 1 + 0.5) * (width / 12);
        const expectedY = ((expectedString + 1) / 7) * fretboard.clientHeight;
        const hint = document.createElement('div');
        hint.classList.add('marker', 'hint');
        hint.style.left = `${expectedX}px`;
        hint.style.top = `${expectedY}px`;
        fretboard.appendChild(hint);
      }

      fretboard.appendChild(marker);

      setTimeout(() => {
        renderFretboard();
        newTask();
      }, 3000);
    }

    document.getElementById('new-task').addEventListener('click', newTask);
    modeSelect.addEventListener('change', () => {
      if (modeSelect.value === 'interval') {
        stringSelect.value = 'all';
      }
      renderFretboard();
      newTask();
      updateInstructions();
      updateNoteControlsVisibility();
    });
    stringSelect.addEventListener('change', () => {
      renderFretboard();
      newTask();
    });
    noteTypeSelect.addEventListener('change', () => {
      renderFretboard();
      newTask();
    });
    showNotesToggle.addEventListener('change', () => {
      renderFretboard();
    });

    // Modal event listeners
    document.getElementById('info-icon').addEventListener('click', () => {
      const mode = modeSelect.value;
      if (mode === 'interval') {
        const intervalContent = `
          <h3>Interval Reference Guide</h3>
          <div style="text-align: left; padding-left: 20px">
            <ol style="padding-left: 20px">
              <li>They Define Chords
                <ul style="padding-left: 20px">
                  <li>Chords are built by stacking intervals on top of a root note.</li>
                  <li>Example: A major chord = root + major 3rd + perfect 5th.</li>
                  <li>Understanding intervals helps you build, name, and modify chords (like turning a major into a minor or a dominant 7th).</li>
                </ul>
              </li>
              <li>They Shape Scales
                <ul style="padding-left: 20px">
                  <li>Scales are just sequences of notes at defined intervals.</li>
                  <li>Example: A major scale = W W H W W W H (W = whole step, H = half step).</li>
                  <li>If you know intervals, you can construct any scale from any root.</li>
                </ul>
              </li>
              <li>They Help With Fretboard Navigation
                <ul style="padding-left: 20px">
                  <li>Intervals stay consistent across the fretboard (except between the G and B strings due to tuning).</li>
                  <li>Learning interval patterns helps you play arpeggios, scales, and chords anywhere on the neck.</li>
                </ul>
              </li>
              <li>They Enable Transposition
                <ul style="padding-left: 20px">
                  <li>Once you know a lick or shape by intervals, you can move it up/down the neck to play it in a different key.</li>
                </ul>
              </li>
            </ol>
          </div>


          <div class="interval-row">
            <span class="interval-name">Minor 2nd</span>
            <span class="interval-semitone">1 semitone</span>
            <span class="interval-description">Half step up (e.g., C to C#)</span>
          </div>
          <div class="interval-row">
            <span class="interval-name">Major 2nd</span>
            <span class="interval-semitone">2 semitones</span>
            <span class="interval-description">Whole step up (e.g., C to D)</span>
          </div>
          <div class="interval-row">
            <span class="interval-name">Minor 3rd</span>
            <span class="interval-semitone">3 semitones</span>
            <span class="interval-description">Three half steps up (e.g., C to D#)</span>
          </div>
          <div class="interval-row">
            <span class="interval-name">Major 3rd</span>
            <span class="interval-semitone">4 semitones</span>
            <span class="interval-description">Four half steps up (e.g., C to E)</span>
          </div>
          <div class="interval-row">
            <span class="interval-name">Perfect 4th</span>
            <span class="interval-semitone">5 semitones</span>
            <span class="interval-description">Five half steps up (e.g., C to F)</span>
          </div>
          <div class="interval-row">
            <span class="interval-name">Tritone</span>
            <span class="interval-semitone">6 semitones</span>
            <span class="interval-description">Six half steps up (e.g., C to F#)</span>
          </div>
          <div class="interval-row">
            <span class="interval-name">Perfect 5th</span>
            <span class="interval-semitone">7 semitones</span>
            <span class="interval-description">Seven half steps up (e.g., C to G)</span>
          </div>
          <div class="interval-row">
            <span class="interval-name">Minor 6th</span>
            <span class="interval-semitone">8 semitones</span>
            <span class="interval-description">Eight half steps up (e.g., C to G#)</span>
          </div>
          <div class="interval-row">
            <span class="interval-name">Major 6th</span>
            <span class="interval-semitone">9 semitones</span>
            <span class="interval-description">Nine half steps up (e.g., C to A)</span>
          </div>
          <div class="interval-row">
            <span class="interval-name">Minor 7th</span>
            <span class="interval-semitone">10 semitones</span>
            <span class="interval-description">Ten half steps up (e.g., C to A#)</span>
          </div>
          <div class="interval-row">
            <span class="interval-name">Major 7th</span>
            <span class="interval-semitone">11 semitones</span>
            <span class="interval-description">Eleven half steps up (e.g., C to B)</span>
          </div>
          <div class="interval-row">
            <span class="interval-name">Octave</span>
            <span class="interval-semitone">12 semitones</span>
            <span class="interval-description">Twelve half steps up (e.g., C to C)</span>
          </div>
        `;
        showModal(intervalContent);
      } else {
        const noteContent = `
          <h3>Note Training Tips</h3>
          <p style="margin-bottom: 20px; line-height: 1.6;">Hint - limit the questions to a single string to focus your learning on one string at a time if you find learning the whole fretboard at the same time overwhelming.</p>
        `;
        showModal(noteContent);
      }
    });

    document.getElementById('modal-close').addEventListener('click', hideModal);
    document.getElementById('modal-overlay').addEventListener('click', (e) => {
      if (e.target.id === 'modal-overlay') {
        hideModal();
      }
    });

    renderFretboard();
    newTask();
    updateInstructions();
    updateNoteControlsVisibility();

    function createParticles(x, y, isCorrect) {
      const particleCount = 1;

      const colors = isCorrect ?
        ['#4CAF50'] :
        ['#f44336'];

      // Use the actual click coordinates from the event
      const pageX = x;
      const pageY = y;

      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';

        // More varied sizes
        const size = 18;
        particle.style.width = size + 'px';
        particle.style.height = size + 'px';

        // Center the particle on the click point
        particle.style.left = (pageX - size/2) + 'px';
        particle.style.top = (pageY - size/2) + 'px';

        particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];

        // More varied movement patterns
        const spreadX = Math.random() * 60 - 30;
        const spreadY = Math.random() * 60 - 30;
        particle.style.transform = `translate(${spreadX}px, ${spreadY}px)`;

        document.body.appendChild(particle);

        setTimeout(() => {
          if (particle.parentNode) {
            particle.parentNode.removeChild(particle);
          }
        }, 1000);
      }
    }

    function updateInstructions() {
      const mode = modeSelect.value;
      const instructionsTitle = document.getElementById('instructions-title');
      const instructionsText = document.getElementById('instructions-text');

      if (mode === 'interval') {
        instructionsTitle.textContent = 'Interval Training';
        instructionsText.textContent = 'In guitar theory (and music theory in general), intervals are the building blocks of melody and harmony. An interval is the distance between two notes, measured in steps or semitones.';
      } else {
        instructionsTitle.textContent = 'Note Training';
        instructionsText.textContent = 'Knowing the notes of the guitar neck from memory is one of the most powerful things you can do as a guitarist. It unlocks fluency, creativity, and precision in virtually every area of your playing. Test your knowledge by  guessing the note on the fretboard.';
      }
    }

    function showModal(content) {
      const modalOverlay = document.getElementById('modal-overlay');
      const modalContent = document.getElementById('modal-content-inner');
      modalContent.innerHTML = content;
      modalOverlay.style.display = 'flex';
    }

    function hideModal() {
      const modalOverlay = document.getElementById('modal-overlay');
      modalOverlay.style.display = 'none';
    }
  </script>
</body>
</html>

